# DeclarationCore

## 対象サーバー
- サーバー名：究極のサバイバル
- 環境：Fabric 1.21.1
- 用途：何でもありサバイバル用 宣戦布告管理

---

## 1. MODの目的

- 宣戦布告を **ゲーム内だけで完結** させる
- Discord未所持ユーザーも公平に参加できる
- 宣戦の可否・状態を **システムで明確化**
- 運営の手動対応・判断を最小限にする

---

## 2. 基本設計思想

- 宣戦布告は「文章」ではなく **構造化データ**
- 書き方の自由度より **誤解が生まれない設計** を優先
- ルールではなく **仕組みで荒らしを防止**

---

## 3. クラン（陣営）システム仕様

### 3.1 クランの位置づけ
- 宣戦布告・判定のための **軽量な陣営**
- 国家・ギルド・経済機能は持たせない

### 3.2 クランの特徴
- MOD独自データまたは連携データとして管理
- 上下関係・権限差なし（ただし、リーダーの概念が存在し宣戦布告等の権限を持つ）
- 宣戦単位としてのみ使用

---

### 3.3 コマンド一覧

本MODの主要コマンドは、すべて `/war` を起点とします。

```text
/war
  ├── clan
  │    ├── set
  │    │    └── war_leader <auto/mcid>  # 戦争リーダーの設定（GUI対応予定）
  │    └── info
  │         ├── all                     # すべての情報を表示
  │         ├── leader                  # リーダー情報を表示
  │         ├── member                  # メンバー情報を表示
  │         └── general                 # 一般情報を表示
  ├── fukoku                            # 宣戦布告GUIを開く
  ├── menu                              # 宣戦管理GUIを開く
  ├── info                              # 宣戦情報の詳細を確認
  ├── end                               # 戦争の終了・キャンセル
  ├── help
  │    └── Commands                     # コマンドのヘルプ一覧を表示
  └── reload                            # 設定リロード（主に管理者用）
```

---

### 3.4 個人扱い

* チーム（クラン）未所属プレイヤーは「個人」として扱う
* 個人 ⇔ クラン / 個人 ⇔ 個人 の宣戦も可能

---

## 4. 宣戦布告システム仕様

### 4.1 宣戦布告の開始

```text
/war fukoku
```

* **宣戦布告はいつでも可能**（OP不要）
* **クランに所属している場合、宣戦布告を実行できるプレイヤーはリーダーのみ**
* 実行すると **GUI（インベントリUI）** を開く

---

### 4.2 GUI入力項目（必須）

1. 宣戦側
   * 自分のクラン or 個人
2. 宣戦対象
   * クラン or 個人（オンライン一覧や指定から選択）
3. 戦争内容
   * PvP：ON / OFF
   * 拠点破壊：ON / OFF
4. 開始時刻
   * 即時（※ただし合意完了から5分間の待機時間あり）
   * 指定時刻（サーバー時間）
5. 備考（任意）
   * フリーテキスト（最大100文字）

---

### 4.3 同時宣戦数の上限（サーバー環境との連動）

* 同時に保持できる・関与できる宣戦数: **最大2件まで**
  * `ACTIVE`（戦争中）上限: **最大1件まで**
  * `PENDING`（合意待ち）数 + `ACTIVE`数: **最大2件まで**
* 上限を超える宣戦布告、または受け取りはシステムによりブロックされる。

---

## 5. 合意システム

### 5.1 合意フロー

* 宣戦対象に **ゲーム内通知** を送信（ログイン時、またはオンライン中）
* 対象側（クランの場合はリーダー）が `/war menu`（GUI）または `/war info` などから合意・拒否を選択する：

* **合意完了から5分後に戦争状態が `ACTIVE` に移行し、戦争が開始される**

---

### 5.2 合意前の制限

* 合意成立前・および開始前の待機時間（5分間）は以下を禁止：
  * PvP
  * 拠点破壊
* 実行しようとした場合：
  * イベントを強制キャンセル
  * 警告メッセージを表示

---

## 6. 宣戦状態管理

### 6.1 状態一覧

* `PENDING`：合意待ち
* `PREPARING`：合意済み（5分間の開始待機中）
* `ACTIVE`：戦争中
* `ENDED`：終了

---

### 6.2 終了条件

* 双方合意による終了
* 設定期間の満了
* `/war end` や管理者による強制終了

---

## 7. 宣戦布告の取り消し（キャンセル）

### 7.1 合意前（PENDING）

* 宣戦側のみ自由に取り消し可能（`/war end` またはGUI等から）
* 相手に通知
* Discordにも取り消し通知を送信

---

### 7.2 合意後・開始前（PREPARING）

* **双方の合意が必要**
* 対象側が承認 / 拒否を選択

---

### 7.3 戦争中（ACTIVE）

* **原則不可**
* 例外：
  * 双方の合意
  * 管理者（運営）による強制終了（`/war end` 等によるオペレーター操作）

---

## 8. 宣戦管理GUI

```text
/war menu
```

* 自分が関与している宣戦一覧を表示
* 状態表示：
  * 合意待ち
  * 開始待機中（5分間）
  * 戦争中
  * 終了

### ボタン例

* 詳細表示
* 合意 / 拒否
* 取り消し（状態に応じて表示）
* 押せない操作はグレーアウト

---

## 9. ゲーム内制御（荒らし防止）

### 9.1 フック対象イベント

* BlockBreakEvent
* EntityDamageByEntityEvent
* ContainerOpenEvent

### 9.2 判定条件

* 宣戦が `ACTIVE` か
* 宣戦対象に含まれているか
* 宣戦条件（PvP / 破壊）を満たしているか
* **例外エリア（安全地帯・公共施設）ではないか**
  * ※「初期スポーンから半径2チャンク以内の保護エリア」や「承認済みの公共施設」においては、戦争中・ルール設定に関わらずPvPおよび対象の破壊・窃盗行為はシステムにブロックされる。

→ 満たさない場合はイベントを強制キャンセル

---

## 10. データ保存仕様

### 10.1 保存形式

* JSON または SQLite
* ワールド単位で保存

### 10.2 保存内容

* war_id
* 宣戦側 / 対象（UUID / クランID）
* 条件（PvP / 破壊）
* 開始・終了時刻
* 合意ログ
* 状態

---

## 11. Discord連携仕様

### 11.1 連携方式

* Discord Webhook（推奨）
* Botアカウント不要

---

### 11.2 通知タイミング

* 宣戦布告作成時
* 合意成立時
* 戦争開始時（待機時間満了時）
* 取り消し時
* 終了時

---

### 11.3 Discord通知フォーマット（例）

```text
【宣戦布告】
宣戦側：Aチーム
対象：Bチーム
PvP：ON
拠点破壊：OFF
開始：2026/03/01 20:00
状態：ACTIVE
```

---

## 12. 管理者用・補助コマンド

* コマンドの詳細は以下から確認可能です：
```text
/war help Commands
```

### 運営の判断基準
* システムや運営が介入するかどうかの基準は以下に大きく依存する：
  * 宣戦布告のログ有無
  * 合意の有無
  * 5分待機時間の経過
  * システムステータス（`ACTIVE` かどうか）
* これら以外の要素（プレイヤー間の個人的な口約束など）は、システム上は原則考慮しない。

---

## 13. 実装上の注意（Fabric）

* サーバー専用MOD
* クライアント側MOD不要
* GUIは ScreenHandler を使用
* 権限管理は独自 or LuckPerms連携（任意）

---

## 14. このMODが実現すること

* Discord未所持ユーザーの切り捨て防止
* 宣戦ルールの明確化
* 荒らしと仕様の自動判定
* 運営負担の大幅削減

---

## 15. 設計哲学

究極のサバイバルは
「何でもできるサーバー」ではなく
**「何をしていいか迷わないサーバー」**

このMODは、そのための中核システムとする。